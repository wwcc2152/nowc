{"entries":{"0":{"key":[],"keysecondary":[],"comment":"===说明（保持关闭）===","content":"**一种相对轻量适合多角色，适合多数场景且高度可定制，易于扩展，兼容性良好（正确配置参数后允许与带CoT或应用MVU/SAM或具有复杂格式的预设/卡等共同使用）的记忆增强表格预设，提供多种快捷操作功能，内置总结配合限制楼层可支持有限token长期聊天**\n\n发布于：https://discord.com/channels/1291925535324110879/1361647748738322432\n\n必需插件：\n记忆增强插件（需2.2.0及以上版本）：https://github.com/muyoou/st-memory-enhancement\n文档：https://muyoo.com.cn/wiki/memory/index.html\n提示词模板插件（需1.11.0.0及以上版本）：https://github.com/zonde306/ST-Prompt-Template\n\n# 立即填表、大总结、整理使用推送到对话的表格中的控制部分按钮，不可使用插件自带的。这三项执行时会将输入框内容作为额外要求。若执行出错（包括中止），可删除生成的层（包括生成的用户消息）并重试。\n\n# 由于使用了提示词模板，有大比例是用来处理提示词的代码，本身不会发给AI，只会发送处理后的结果。所以世界书界面和对话补全预设界面显示的token统计都是严重偏高的，实际token占用请通过消息右上角提示词按钮查看\n\n本表格预设基于404的0.66版预设：https://discord.com/channels/1291925535324110879/1347479196514910229\n进行了大量修改\n\n# 使用方法\n（1-7只需执行一次，只要没有再进行导入其他表格预设/改变对话补全预设等影响到有关部分的操作）\n1. 关闭聊天\n2. 安装记忆表格增强插件和提示词模板插件\n3. 导入表格预设（参见 https://muyoo.com.cn/wiki/memory/presets.html ）、配套世界书和配套全局正则（用户消息包裹、[隐藏][不发送]tablethink、[隐藏][不发送]tableedit），用户消息包裹置于全局正则底部（如果预设已经自带用户消息包裹，无论是通过正则还是通过预设条目包裹{{lastUserMessage}}，也可以不开启这里的用户消息包裹正则，而是在参数中配置为预设已有的用户消息标签；但注意如果是通过正则实现的，同样应当置于底部），世界书设为全局且不要改名\n世界书包括参数配置、参数处理、表格提示词（因此表格预设已关闭注入）及后置强调\n4. 如果预设包含列举标签结构，需要在正文后加入<tableThink>和<tableEdit>，并修正冲突的表述；与MVU/SAM共同使用时推荐<UpdateVariable>置于<tableThink>前，设置tableConfigTagsBeforeTableEdit参数；如果想要加强重要指引表对正文的效力，可以在预设CoT部分添加一条“简要分行复述<table_stored>内重要指引表中可能和本次生成正文有关的内容，包括不确定是否相关的”\n5. 强烈建议配套限制发送消息层数到5-10层，可选方式包括：\n  - 通过全局正则：[隐藏][不发送]远楼层消息\n    置于全局正则顶部，通过正则设置中的最小深度控制保留层数，好处是同时能够防止后续正则对远楼层的处理，防止这方面的卡顿；预设等已有同类正则的话也可以用，不必再导入，但同样注意置于顶部\n  - 通过插件：https://github.com/SillyTavern/Extension-MessageLimit\n    好处是可通过命令配置层数，可用于某些QR；但会破坏世界书的原生时效功能，包括黏性、冷却、延迟，但这些功能很少用到\n  - 同时使用以上两种方案：\n    正则用于防止卡顿，设较高的层数，允许用户查看较多历史消息；插件设置较小层数，用以限制发送消息层数\n  - 通过/hide：\n    效果等同插件，但较麻烦，不推荐\n6. 在完成以上操作后再开启**新**聊天，以上步骤都正确时将在新聊天中推送到对话的表格部分开头显示插件、预设、世界书版本号\n7. 通过推送到对话的参数配置部分，依据常用预设和偏好配置参数，再点击存储聊天参数到全局按钮\n8. 依据角色卡配置仅限于此聊天的参数\n9. 然后开始正常聊天，使用过程中务必保证时间精确到天和小时（默认应当也有分钟但不必须）。**强烈推荐每次回复后检查推送到对话的表格是否正确，出现问题请及时处理，否则AI就会模仿着继续错下去**\n\n**通常只需检查当前信息及近期角色表格是否正确，其他推送表格通常无需改变因此只需扫一眼是否有多余操作即可，仅当需要更新时才需关注其他表格；且可选通过推送到对话的控制部分隐藏不变项**\n\n如果觉得每次要往上翻比较麻烦的话，可以通过控制部分配置隐藏不变项及生成后自动跳转，并如图关闭自动滚动聊天。\n\n当前信息、近期角色以及事件历史表高频更新，其他低频更新，大总结表和重要指引表基本不更新，因此配置除后两者外推送至对话。\n\n此外，若要分析特定重要对象以记录，可以使用这一QR：https://discord.com/channels/1291925535324110879/1365965189253435462/1368492329802924184\n\n# 不填表/错误填表自查流程\n适用于持续/频繁完全不填表/大范围错误填表的情形；如果只是希望推测填写未知信息则打开推测填表配置参数即可\n1. 如果有红色报错EJS Error，且内容与表格有关，检查是否有思维链有关的正则的范围包括世界信息，范围去掉世界信息；检查提示词模板版本是否需要更新\n2. 检查表格提示词是否发送，如果未发送：\n  1. 检查当前聊天的表格是否是我的预设的表格，结构参见顶楼\n  2. 检查配套世界书是否设为全局世界书，世界书条目是否打开了参数配置、参数处理、表格提示词、后置强调，全局正则是否打开用户消息包裹并置于底部\n  3. 检查全局世界书设置中上下文百分比、token预算上限（0表示不限制）是否过低\n  4. 检查对话补全预设中的上下文长度是否过低\n  5. 如果开启了向量存储插件和启用世界信息选项，检查最大条目数是否够大（会限制所有世界书激活条目的总数，而不只是通过向量激活的。。。）\n3. 检查参数配置是否正确，注意按照同时使用的预设/全局世界书/卡的标签格式来填写；简单来说，可以查看不开表格有关的东西时正常输出的消息中的标签结构，据此填写\n4. 消息右上角铅笔点开消息编辑，检查tableThink和tableEdit标签（含头尾）及内容是否完整\n  1. 如果只输出了一半就结束，检查对话补全预设中最大回复长度是否过低导致达到上限中止输出\n  2. 如果完全没有，检查预设是否有提示词列举了**全部**输出标签格式，如果有的话检查是否加入了tableThink和tableEdit标签\n5. 检查其他世界书（包括角色卡绑定世界书）是否d0插入过多内容或预设在历史消息后插入过多内容，如果是的话可以尝试将表格提示词深度降低到d0（或适当修改其他这些世界书的条目深度，并不建议在d0堆太多东西）\n6. 检查是否有其他可能影响到表格操作的正则\n7. 如果开启了noass，关闭Enable Stop String选项。这个东西本来是用来防止AI输出回应后继续输出本应是用户输入的内容。如果关闭后有这样继续输出的问题，可以换成在世界书或者预设的比较重要的地方加一句“你必须只补完一条消息”来代替（我之前是这样干的）。此外Response Max Symbols应足够大。\n8. 如果原先没有开启不发送表格操作的正则 https://discord.com/channels/1291925535324110879/1361647748738322432/1399053155232252017 ，可以尝试开启；如果原先开启了，在保证近期楼层内表格操作都正确的前提下，可以尝试关闭\n\n# 表格结构\n#0 当前信息|0:时间|1:地点\n\n一些基础信息，结合近期角色表可代替一些状态栏。\n\n#1 近期角色|0:角色名|1:离场轮数|2:即时目标|3:位置|4:姿势|5:身体状态|6:服装|7:特殊状态\n\n通过离场轮数控制删除行。**当前写的是达到5时删除，可随回复长短按需调整参数，比如短回复可能提高一些限额。**另一方面，离场轮数只用于控制删除，比如“当前轮离开的角色置为1还是0”、“本轮达到5删除还是下一轮删除”等都不要紧，只要保证未出场角色的计数在+1，后续输出AI就会自动处理。\n\n#2 角色信息|0:角色名|1:性别|2:年龄|3:身份|4:身体特征|5:服装偏好风格|6:性格|7:喜好|8:长期目标|9:关系|10:对<user>态度|11:角色间重要关系|12:重要背景设定|13:重要备注\n\n通常不变的重要角色信息。其中记录服装偏好风格而非服装，用以允许日常更换服装。\n仅限用户声明时删除，允许角色隔几十上百层再出场，乃至死亡角色要保留作为背景之类的需求。\n\n#3 性爱信息|0:角色名|1:相对敏感身体部位|2:初体验|3:擅长性爱技巧|4:隐私部位细节|5:近期性爱对象|6:重要备注\n#4 日程|0:概要|1:整体内容|2:当前进度|3:执行人|4:委托人|5:完成奖励|6:地点|7:起始时间|8:结束或限制时间|9:重要备注\n#5 特殊能力|0:能力|1:拥有人|2:作用|3:限制|4:重要备注\n#6 重要物品|0:物品|1:拥有人|2:所在位置|3:数量|4:形态|5:作用|6:限制|7:重要备注\n#7 重要组织|0:组织|1:已知成员架构|2:成员特征|3:宗旨|4:重要备注\n#8 重要地点|0:地点|1:所在位置|2:空间结构|3:重要备注\n\n一些常用组件。**可按需配置参数开关。**\n\n#9 大总结|0:时间范围|1:内容\n\n需要大总结时点击按钮执行，不自动大总结。从而允许仅当故事告一段落时（我自己使用一般是百来层）才进行大总结，避免将一个事件分割到两个大总结中，同时也进一步保证了事件历史表无误。**默认要求不超过5段，每段200 token以内，可按需调整参数。**\n\n#10 事件历史|0:时间|1:地点|2:事件\n\n每轮总结事件，默认不超过3行、每行100 token以内的参数，适配长回复的gemini。**如果短回复也可以考虑适当减小。**\n大总结时会清空，且仅限大总结时会删除。\n**可按需配置参数开关。**\n\n#11 重要指引|0:内容\n\n只读，用于存储自定义要求（不限于对表格的要求），例如：\n写一行\n> 角色属性应记录在特殊能力表，在重要备注列以“xxxx”的格式记录属性数值\n就能添加角色属性的记录\n写一行\n> 每当时间变更到新的一月，资金增加等于月净利润的值\n就能按要求增加资金\n\n# 其他功能\n通过tableConfigPresumeMode参数控制是否推测未知信息并填表\n通过tableConfigCharacterReferenceName和tableConfigCharacterReferenceSource参数允许引用特定标题或标签的详细内容，避免有关内容记录到表格而受到简化\n通过推送到对话的表格下方界面允许切换是否隐藏不变表格，是否自动换行，快速跳转，执行一些表格相关操作及进行一些聊天快捷操作\n\n# 核心思想\nAI输出不可避免存在错误，我们的目标是人工检查和修改最小化，因此：\n- 分离需要高频/低频操作的表格\n- 对于高频操作表格，尽量容忍AI输出错误并在后续轮中自修复\n- 对于极低频更新表格，宁可少修改（需要修改时可能需要用户提醒），也胜过AI频繁改错导致需要用户总是检查且频繁修正或重新生成\n\n此外配合世界书使用，将需要强调的内容分离并后置d0，允许表格提示词只置于d1，以保证对用户最后消息的注意力","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":2000,"position":4,"disable":true,"excludeRecursion":true,"preventRecursion":true,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":999,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"uid":0,"displayIndex":4,"triggers":[]},"1":{"key":[],"keysecondary":[],"comment":"参数处理","content":"<%_ //以下为中间处理过程，禁止任何修改\nif (!('tableConfigSaved' in variables)) {\n  toastr.success('已应用全局参数到聊天', 'LSR的表格预设');\n} else if ('tableConfigModified' in variables) {\n  toastr.success('已配置聊天参数', 'LSR的表格预设');\n} else if (getLocalVar('tableConfigLorebookVersion') != '2.0.11') {\n  toastr.success('世界书版本更新为v2.0.11', 'LSR的表格预设');\n  if (getLocalVar('tableConfigSummaryRows') === '5') {\n    setLocalVar('tableConfigSummaryRows', '不超过5段', { dryRun: true });\n  }\n  if (getLocalVar('tableConfigDateMode') === '1') {\n    setLocalVar('tableConfigDateFormat', 'YYYY-MM-DD', { dryRun: true });\n    setLocalVar('tableConfigExtraTimeFormat', '星期X', { dryRun: true });\n    setLocalVar('tableConfigTimeFormat', 'hh:mm', { dryRun: true });\n    execute('/flushvar tableConfigDateMode');\n  } else if (getLocalVar('tableConfigDateMode') === '0') {\n    setLocalVar('tableConfigDateFormat', '第n日', { dryRun: true });\n    setLocalVar('tableConfigExtraTimeFormat', '星期X', { dryRun: true });\n    setLocalVar('tableConfigTimeFormat', 'hh:mm', { dryRun: true });\n    execute('/flushvar tableConfigDateMode');\n  }\n}\nif (!('tableConfigSaved' in variables) || ('tableConfigModified' in variables) || (getLocalVar('tableConfigLorebookVersion') != '2.0.11') || (SillyTavern.chat.length < 8)) {\n  setLocalVar('tableConfigSaved', '1', { dryRun: true });\n  if ('tableConfigModified' in variables) {\n    execute('/flushvar tableConfigModified');\n  }\n  setLocalVar('tableConfigLorebookVersion', '2.0.11', { dryRun: true });\n  setLocalVar('tableConfigStatusNote', '当前基础信息，包括：时间（格式为：'+getLocalVar('tableConfigDateFormat')+((getLocalVar('tableConfigExtraTimeFormat') != 'none')?('/'+getLocalVar('tableConfigExtraTimeFormat')):'')+'/'+getLocalVar('tableConfigTimeFormat')+'，依据故事推进）|地点（格式为：国家/城区/地址/具体位置，可简化）。即使故事中时间模糊，也必须依据上下文和相关设定，推测并填写明确时间', { dryRun: true });\n  setLocalVar('tableConfigStatusInit', '必须使用insertRow插入一行，必须写出明确时间和地点，禁止留空或置零', { dryRun: true });\n  setLocalVar('tableConfigStatusUpdate', '回复中有关信息发生变化时更新。时间一列必须首先依据故事准确估计推进了多少时间（应采取较少的时间估计），然后再加到原时间上得到现时间，并更新', { dryRun: true });\n  setLocalVar('tableConfigRecentNote', '近期出场角色的即时状态，包括：角色名|离场轮数（0~'+getLocalVar('tableConfigRecentLimit')+'，作为删除行的唯一依据）|即时目标（当前行动的直接目标，非长期目标）|位置（仅限具体位置，包括与临近角色的位置关系）|姿势|身体状态（如汗、伤口、泪、性器官变化等，不含穿着、情绪、心理或精神状态）|服装（包含服装状态，更换时替代，脱衣时标注(脱)，受损标注受损方式，完全损毁或丢失时删除）|特殊状态（仅限上文**存在明确机制定义**的buff、debuff、临时生效的特殊能力或物品等，不含永久状态）', { dryRun: true });\n  setLocalVar('tableConfigRecentInit', '必须寻找回复中出场的所有角色，对每个角色使用insertRow插入一行（将<user>作为第0行首先插入）', { dryRun: true });\n  setLocalVar('tableConfigRecentInsert', '回复中出现任何在近期角色表内未记录的角色时插入', { dryRun: true });\n  setLocalVar('tableConfigRecentUpdate', '回复中出场角色在回复结尾的状态与表格记录不同时更新，其中离场轮数总是置为0，其他列仅记录回复结尾的状态，不记录过程中的状态；离场角色仅更新离场轮数分别+1，其余列禁止更新', { dryRun: true });\n  setLocalVar('tableConfigRecentDelete', '仅限原离场轮数达到'+getLocalVar('tableConfigRecentLimit')+'且本次回复中未出场时删除', { dryRun: true });\n  setLocalVar('tableConfigCharacterNote', '角色天生或难以改变的重要信息，记录所有'+getLocalVar('tableConfigCharacterMember')+'，不含即时状态'+(getLocalVar('tableConfigSexWrite') == '1')?'，不含性爱相关信息':''+'，包括：角色名|性别|年龄（准确值）|身份|身体特征（不含服装、配饰、姿势、状态）|服装偏好风格（粗略风格、必备配饰等，并非当前服装，禁止填写具体款式）|性格（不含即时状态如情绪、反应）|喜好（兴趣、爱好、嗜好品等，禁止填写本职）|长期目标|关系（是<user>的——）|对<user>态度（仅限对<user>整体态度，包括好感度、关系值等，不含即时状态如情绪、反应）|角色间重要关系（写作“【角色名】的【关系】”，最多列举4种）|重要背景设定（仅限由角色说出或回忆或存在于设定中的重要背景经历，不含角色当前或上文经历）|重要备注', { dryRun: true });\n  setLocalVar('tableConfigCharacterInit', '必须寻找回复中出场的所有'+getLocalVar('tableConfigCharacterMember')+'，对每个角色使用insertRow插入一行（将<user>作为第0行首先插入）', { dryRun: true });\n  setLocalVar('tableConfigCharacterInsert', '回复中出现任何在角色信息表内未记录的'+getLocalVar('tableConfigCharacterMember')+'时插入', { dryRun: true });\n  setLocalVar('tableConfigCharacterUpdate', '回复中有关信息发生变化时更新；禁止包含即时状态', { dryRun: true });\n  setLocalVar('tableConfigCharacterDelete', '仅限用户在'+getLocalVar('tableConfigUserInput')+'中要求删除角色时删除', { dryRun: true });\n  if (getLocalVar('tableConfigSexWrite') == '1') {\n    setLocalVar('tableConfigSexUpdate', '除原空白格获得新信息外，仅限回复中发生如破处、激烈调教开发等会导致有关信息发生重大变化的事件，且事件结束时才更新；禁止包含即时状态', { dryRun: true });\n    setLocalVar('tableConfigSexDelete', '仅限用户在'+getLocalVar('tableConfigUserInput')+'中要求删除角色时删除', { dryRun: true });\n    if (getLocalVar('tableConfigSexUser') == '1') {\n      setLocalVar('tableConfigSexNote', '角色天生或难以改变的性爱特质信息，不含性唤起等即时状态，仅限<user>及所有'+getLocalVar('tableConfigSexMember')+'，包括：角色名|相对敏感身体部位|初体验（被谁以什么方式破处）|擅长性爱技巧（仅列举给予他人性快感的方式和相应水平）|隐私部位细节（仅限日常不可见的细节特征，不含巨乳等身材外形）|近期性爱对象（列举角色或概括角色群体）|重要备注', { dryRun: true });\n      if (SillyTavern.chat.length < 4) {\n        setLocalVar('tableConfigSexInsert', '必须寻找回复中出场的<user>自身以及所有'+getLocalVar('tableConfigSexMember')+'，对每个在性爱信息表内未记录的角色使用insertRow插入一行（将<user>作为第0行首先插入）', { dryRun: true });\n      } else {\n        setLocalVar('tableConfigSexInsert', '回复中出现任何在性爱信息表内未记录的'+getLocalVar('tableConfigSexMember')+'时插入', { dryRun: true });\n      }\n    } else {\n      setLocalVar('tableConfigSexNote', '角色天生或难以改变的性爱特质信息，禁止包含即时状态，仅限所有'+getLocalVar('tableConfigSexMember')+'，不含<user>，包括：角色名|相对敏感身体部位|初体验（被谁以什么方式破处）|擅长性爱技巧（仅列举给予他人性快感的方式和相应水平）|隐私部位细节（仅限日常不可见的细节特征，不含巨乳等身材外形）|近期性爱对象（列举角色或概括角色群体）|重要备注', { dryRun: true });\n      setLocalVar('tableConfigSexInsert', '回复中出现任何在性爱信息表内未记录的'+getLocalVar('tableConfigSexMember')+'时插入，不含<user>', { dryRun: true });\n    }\n  } else {\n    setLocalVar('tableConfigSexNote', '角色天生或难以改变的性爱特质信息，不含性唤起等即时状态，包括：角色名|相对敏感身体部位|初体验（被谁以什么方式破处）|擅长性爱技巧（仅列举给予他人性快感的方式和相应水平）|隐私部位细节（仅限日常不可见的细节特征，不含巨乳等身材外形）|近期性爱对象（列举角色或概括角色群体）|重要备注；表格只读，禁止更新、删除、插入', { dryRun: true });\n    setLocalVar('tableConfigSexInsert', '禁止插入', { dryRun: true });\n    setLocalVar('tableConfigSexUpdate', '禁止更新', { dryRun: true });\n    setLocalVar('tableConfigSexDelete', '禁止删除', { dryRun: true });\n  }\n  if (getLocalVar('tableConfigScheduleWrite') == '1') {\n    setLocalVar('tableConfigScheduleNote', '已接受的日程，包括：概要（5 token以内）|整体内容（即执行人所需完成要素）|当前进度|执行人|委托人|完成奖励|地点|起始时间（格式为：'+getLocalVar('tableConfigDateFormat')+'/'+getLocalVar('tableConfigTimeFormat')+'，可简化）|结束或限制时间（格式同起始时间，无限制则填N/A）|重要备注', { dryRun: true });\n    setLocalVar('tableConfigScheduleInsert', '回复中出现角色明确接受（不含只列出尚未接受）的新日程时插入', { dryRun: true });\n    setLocalVar('tableConfigScheduleUpdate', '回复中有关信息发生变化时更新，对于已进行中的日程无需更新起始时间', { dryRun: true });\n    setLocalVar('tableConfigScheduleDelete', '回复中日程结束时删除，包括日程**完成、主动取消、超时或不再有效**等，而非更新当前进度', { dryRun: true });\n  } else {\n    setLocalVar('tableConfigScheduleNote', '已接受的日程，包括：概要（5 token以内）|整体内容（即执行人所需完成要素）|当前进度|执行人|委托人|完成奖励|地点|起始时间|结束或限制时间（无限制则填N/A）|重要备注；表格只读，禁止更新、删除、插入', { dryRun: true });\n    setLocalVar('tableConfigScheduleInsert', '禁止插入', { dryRun: true });\n    setLocalVar('tableConfigScheduleUpdate', '禁止更新', { dryRun: true });\n    setLocalVar('tableConfigScheduleDelete', '禁止删除', { dryRun: true });\n  }\n  if (getLocalVar('tableConfigAbilityWrite') == '1') {\n    setLocalVar('tableConfigAbilityNote', '角色特殊能力有关信息，包括：能力|拥有人|作用|限制（条件、代价、冷却时间等）|重要备注', { dryRun: true });\n    setLocalVar('tableConfigAbilityInsert', '回复中出现特殊能力表内未记录的能力-拥有人组合时插入，**不含由物品带来的能力**', { dryRun: true });\n    setLocalVar('tableConfigAbilityUpdate', '回复中有关信息发生变化时更新，包括具有完全相同的特殊能力的角色增减时应更新拥有人而非插入新行', { dryRun: true });\n    setLocalVar('tableConfigAbilityDelete', '回复中角色特殊能力转移或失去时删除，或用户在'+getLocalVar('tableConfigUserInput')+'中要求删除的角色包括一行所有拥有人时删除', { dryRun: true });\n  } else {\n    setLocalVar('tableConfigAbilityNote', '角色特殊能力有关信息，包括：能力|拥有人|作用|限制（条件、代价、冷却时间等）|重要备注；表格只读，禁止更新、删除、插入', { dryRun: true });\n    setLocalVar('tableConfigAbilityInsert', '禁止插入', { dryRun: true });\n    setLocalVar('tableConfigAbilityUpdate', '禁止更新', { dryRun: true });\n    setLocalVar('tableConfigAbilityDelete', '禁止删除', { dryRun: true });\n  }\n  setLocalVar('tableConfigItemNote', '重要物品有关信息，包括：物品|拥有人（物品归属，并非当前持有人）|所在位置（当前由谁随身携带，或不被携带的话存放于何处）|数量|形态（仅限外观和结构）|作用|限制（条件、代价、冷却时间等）|重要备注', { dryRun: true });\n  setLocalVar('tableConfigItemInsert', '回复中出现物品表内未记录的物品-拥有人组合时插入', { dryRun: true });\n  setLocalVar('tableConfigItemUpdate', '回复中有关信息发生变化时更新，包括具有完全相同的物品的角色增减时应更新拥有人而非插入新行', { dryRun: true });\n  setLocalVar('tableConfigItemDelete', '回复中角色丢弃、失去或耗尽物品时删除，或用户在'+getLocalVar('tableConfigUserInput')+'中要求删除的角色包括一行所有拥有人时删除', { dryRun: true });\n  if (getLocalVar('tableConfigOrganizationWrite') == '1') {\n    setLocalVar('tableConfigOrganizationNote', '重要组织有关信息，包括：组织|已知成员架构|成员特征|宗旨|重要备注', { dryRun: true });\n    setLocalVar('tableConfigOrganizationInsert', '回复中出现重要组织表内未记录的重要组织时插入', { dryRun: true });\n    setLocalVar('tableConfigOrganizationUpdate', '回复中有关信息发生变化时更新', { dryRun: true });\n    setLocalVar('tableConfigOrganizationDelete', '仅限用户在'+getLocalVar('tableConfigUserInput')+'中要求删除组织时删除', { dryRun: true });\n  } else {\n    setLocalVar('tableConfigOrganizationNote', '重要组织有关信息，包括：组织|已知成员架构|成员特征|宗旨|重要备注；表格只读，禁止更新、删除、插入', { dryRun: true });\n    setLocalVar('tableConfigOrganizationInsert', '禁止插入', { dryRun: true });\n    setLocalVar('tableConfigOrganizationUpdate', '禁止更新', { dryRun: true });\n    setLocalVar('tableConfigOrganizationDelete', '禁止删除', { dryRun: true });\n  }\n  if (getLocalVar('tableConfigLocationWrite') == '1') {\n    setLocalVar('tableConfigLocationNote', '重要地点有关信息，包括：地点|所在位置|空间结构|重要备注', { dryRun: true });\n    setLocalVar('tableConfigLocationInsert', '回复中出现重要地点表内未记录的重要地点时插入', { dryRun: true });\n    setLocalVar('tableConfigLocationUpdate', '回复中有关信息发生变化时更新', { dryRun: true });\n    setLocalVar('tableConfigLocationDelete', '仅限用户在'+getLocalVar('tableConfigUserInput')+'中要求删除地点时删除', { dryRun: true });\n  } else {\n    setLocalVar('tableConfigLocationNote', '重要地点有关信息，包括：地点|所在位置|空间结构|重要备注；表格只读，禁止更新、删除、插入', { dryRun: true });\n    setLocalVar('tableConfigLocationInsert', '禁止插入', { dryRun: true });\n    setLocalVar('tableConfigLocationUpdate', '禁止更新', { dryRun: true });\n    setLocalVar('tableConfigLocationDelete', '禁止删除', { dryRun: true });\n  }\n  setLocalVar('tableConfigSummaryNote', '对故事中发生事件历史进一步精简的大总结，包括：时间范围（只精确到天）|内容', { dryRun: true });\n  setLocalVar('tableConfigSummaryInsert', '仅限用户在'+getLocalVar('tableConfigUserInput')+'中要求“大总结”时插入，仅基于事件历史表，适当分为'+getLocalVar('tableConfigSummaryRows')+'，每段总结并压缩至'+getLocalVar('tableConfigSummaryLength')+'精简内容（禁止输出到正文），只保留故事要点，对每一段大总结内容使用insertRow插入一行，并使用deleteRow逆序删除全部事件历史条目直至第0行，示例:\\\"deleteRow(9, 19)、deleteRow(9, 18)…deleteRow(9, 0)\\\"', { dryRun: true });\n  if (getLocalVar('tableConfigHistoryRows') != 'none') {\n    setLocalVar('tableConfigHistoryNote', '对故事中发生事件历史的总结，包括：时间（格式为：'+getLocalVar('tableConfigDateFormat')+'/时段）|地点（国家/城区/地址，可简化）|事件（'+getLocalVar('tableConfigHistoryLength')+'）', { dryRun: true });\n    setLocalVar('tableConfigHistoryInsert', '本次回复中剧情推进时，依据剧情所涉及时间和地点划分，按回复内容总结'+getLocalVar('tableConfigHistoryRows')+'当前的事件历史并插入', { dryRun: true });\n  } else {\n    setLocalVar('tableConfigHistoryNote', '对故事中发生事件历史的总结，包括：时间（格式为：'+getLocalVar('tableConfigDateFormat')+'/时段）|地点（国家/城区/地址，可简化）|事件（'+getLocalVar('tableConfigHistoryLength')+'）；表格只读，禁止更新、删除、插入', { dryRun: true });\n    setLocalVar('tableConfigHistoryInsert', '禁止插入', { dryRun: true });\n  }\n  setLocalVar('tableConfigGuidelineNote', '你必须遵守的用户要求和补充提示信息等重要指引；表格只读，禁止更新、删除、插入', { dryRun: true });\n} _%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":2000,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":true,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":999,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"uid":1,"displayIndex":0,"triggers":[]},"2":{"key":[],"keysecondary":[],"comment":"参数配置","content":"<%_ //以下为全局参数，非必要无需直接修改世界书\n//若要恢复当前聊天参数为全局参数，请点击推送到对话的表格中的参数配置-应用全局参数到聊天按钮\n//若要修改全局参数，请在配置聊天参数后再点击推送到对话的表格中的参数配置-存储聊天参数到全局按钮\n//所有注释都在对应内容下方\n//参数内部不得包含单引号'\n//为避免宏替换，若参数需要在世界书中配置为{{user}}，不能直接写{{user}}，而应写作{{us'+'er}}，如tableConfigCharacterReferenceSource的示例\n//设为只读的表格，AI将不会进行操作。仍可以手动修改表格让AI读取，也可以直接不使用该表格。同时可通过表格插件-模板-编辑表格显示样式-推送至对话选项关闭显示\nif (getLocalVar('tableConfigSaved') == undefined) {\n//仅限当前聊天未配置聊天参数时依据全局参数执行一次配置，因此可以对不同聊天应用不同配置\n//若有多种常用配置，可以复制本条目以存入不同配置，但注意仅按需开启对应的一条世界书条目，且名称需保留“参数配置”\n  setLocalVar('tableConfigCoTBegin', '<thinking>', { dryRun: true });\n  setLocalVar('tableConfigCoTEnd', '</thinking>', { dryRun: true });\n  //当前使用的预设/全局世界书/角色卡绑定世界书中开启的思维链的标签名称，如'<think>'、'<thinking>'等。对于包含多个思维链标签的预设，应全部写出，如先<thinking>后<think>则改为'<thinking>、<think>'。若无思维链则都修改为'none'（不含尖括号）\n\n  setLocalVar('tableConfigContentBegin', '<content>', { dryRun: true });\n  setLocalVar('tableConfigContentEnd', '</content>', { dryRun: true });\n  //当前使用的预设/全局世界书/角色卡绑定世界书中开启的正文的标签名称，如'<content>'、'<now_plot>'等。对于包含多个正文标签的预设，应全部写出。若无正文标签则无需修改，保留原<content>标签即可。\n\n  setLocalVar('tableConfigTagsBeforeTableEdit', 'none', { dryRun: true });\n  setLocalVar('tableConfigTagsAfterTableEdit', 'none', { dryRun: true });\n  //需要在正文后的表格操作前/后输出的其他标签，通常不需要设置。若复杂结构的预设/卡无法正确按照格式输出时可以配置此参数，越靠前越优先，要求作为表格操作参考对象的配置为表格操作前标签，反之配置为表格操作后标签（例如与正文无关的项目）。例如与MVU/SAM共同使用可将tableConfigTagsBeforeTableEdit配置为'<UpdateVariable>'。对于前几层有特殊格式要求的前端卡可能需要在进入正文生成时再配置以上参数。\n\n  setLocalVar('tableConfigUserInput', '<user_input>', { dryRun: true });\n  //当前使用的预设或正则中的用户输入的标签名称，如'<user_input>'、'<{{user}}'s script>'等。若无用户输入标签则无需修改，保留原<user_input>标签即可，并且需要导入并开启配套的包裹用户输入的全局正则。\n\n  setLocalVar('tableConfigDateFormat', 'YYYY-MM-DD', { dryRun: true });\n  setLocalVar('tableConfigExtraTimeFormat', '星期X', { dryRun: true });\n  setLocalVar('tableConfigTimeFormat', 'hh:mm', { dryRun: true });\n  //选择日期、附加时间（仅当前信息表有效）和时间记录格式，注意日期是本预设重要信息，必须保证正确记录。若卡有明确起始日期则可选择记录年月日；若只有模糊日期且选择记录年月日时不能给出正确起始日期则可在首楼发送起始日期辅助填表；若日期完全无关则将tableConfigDateFormat设为'第n日'；也可按需添加时辰等，同一参数内也允许包含多项元素；若无需附加时间项则将tableConfigExtraTimeFormat设为'none'\n\n  setLocalVar('tableConfigPresumeMode', '1', { dryRun: true });\n  //推测填表加强模式，可选项包括：0-关闭推测，只记录已知信息；1-推测记录未知信息\n\n  setLocalVar('tableConfigRecentLimit', '5', { dryRun: true });\n  //离场几轮后从近期角色表删除角色，若角色有限且需要长期追踪角色临时状态可适当增加\n\n  setLocalVar('tableConfigCharacterReferenceName', '{{us'+'er}}', { dryRun: true });\n  setLocalVar('tableConfigCharacterReferenceSource', '<{{us'+'er}}>', { dryRun: true });\n  //要求特定角色（比如有详细用户角色描述的user，或有蓝灯详细描述的角色等）不将初始信息记录进入表格，而写作参见xxx，表格只记录改变和新增信息。两个参数分别是有关角色名和参见设定来源（标签或标题等），上述范例表示用户角色描述由<{{user}}>包裹，因此要求将{{user}}的初始信息写作参见<{{user}}>。若有多个角色则写作'xxx或xxx'的形式，若不需要此功能则都修改为'none'（不含尖括号）\n\n  setLocalVar('tableConfigCharacterMember', '角色', { dryRun: true });\n  //角色信息表包含哪些角色，可加任何限制，比如'具有姓名或代号的重要角色（不含无名角色）'\n\n  setLocalVar('tableConfigSexWrite', '1', { dryRun: true });\n  //性爱信息表是否写表，可选项包括：0-只读；1-可写\n  setLocalVar('tableConfigSexUser', '1', { dryRun: true });\n  //性爱信息表是否包含user，可选项包括：0-不包含；1-包含\n  setLocalVar('tableConfigSexMember', '重要角色', { dryRun: true });\n  //性爱信息表除user外包含哪些角色，可加任何限制，比如'与{{user}}发生恋爱或性关系的女性角色'\n\n  setLocalVar('tableConfigScheduleWrite', '1', { dryRun: true });\n  //日程表是否写表，可选项包括：0-只读；1-可写\n\n  setLocalVar('tableConfigAbilityWrite', '1', { dryRun: true });\n  //特殊能力表是否写表，可选项包括：0-只读；1-可写\n\n  setLocalVar('tableConfigOrganizationWrite', '1', { dryRun: true });\n  //重要组织表是否写表，可选项包括：0-只读；1-可写\n\n  setLocalVar('tableConfigLocationWrite', '1', { dryRun: true });\n  //重要地点表是否写表，可选项包括：0-只读；1-可写\n\n  setLocalVar('tableConfigSummaryRows', '不超过5段', { dryRun: true });\n  setLocalVar('tableConfigSummaryLength', '100-200 token', { dryRun: true });\n  //大总结表每次总结段数、每段token数，默认的5段、200 token以内适合于比如一百来层大总结一次的情形，可按需调整\n\n  setLocalVar('tableConfigHistoryRows', '不超过3行', { dryRun: true });\n  setLocalVar('tableConfigHistoryLength', '50-100 token', { dryRun: true });\n  //事件历史表每轮总结行数、每行token数；tableConfigHistoryRows置为'none'时关闭事件历史表写入\n} _%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":2000,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":true,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":999,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"uid":2,"displayIndex":1,"triggers":[]},"4":{"key":[],"keysecondary":[],"comment":"表格提示词","content":"<memory_table_guide>\n记录在<table_stored>中的CSV格式的记忆表格存储了上文的数据、状态和特质，是你生成新的正文的重要参考。新生成的正文应基于存储的表格，并在生成正文后先在<tableThink>内分析应当如何修改表格，再在<tableEdit>内使用Javascript函数的格式修改表格。\n\n以下为分析和修改记忆表格的范例，此范例仅作为格式范例（包括哪些项目是“禁止”项），与内容无关，禁止抄写有关具体内容\n日期和时间格式必须遵循<table_rule>要求而非下述范例\n<table_example>\n【仅限<table_example>范例，具有以下原数据：\n当前信息表时间为2025-09-07/星期五/23:00\n近期角色表有Alice、Bob、Carol、Dan四行，Bob行离场轮数为{{getvar::tableConfigRecentLimit}}，Carol行离场轮数为<%- getLocalVar('tableConfigRecentLimit')-1; %>\n角色信息表有Alice、Bob、Carol、Dan四行，Dan行喜好列为台球】\n<tableThink>\n<!--\n<%_ if (SillyTavern.chat.length < 4) { _%>\n0. 表格操作重要要求：\n  - 表格操作仅限插入，禁止更新或删除\n  - 对角色信息表，{{user}}行，9:关系、10:态度和11:角色间重要关系三列都必须填写N/A；对其余行必须分别填写与{{user}}是什么关系、对{{user}}是什么态度和与{{user}}外其他角色是什么关系\n<%_ if (getLocalVar('tableConfigCharacterReferenceName') != 'none') { _%>\n  - “多表格要求”中的写作“参见{{getvar::tableConfigCharacterReferenceSource}}”的要求**仅限于近期角色表、角色信息表<%- (getLocalVar('tableConfigSexWrite') == '1')?'、性爱信息表':''; %>中的{{getvar::tableConfigCharacterReferenceName}}行**，其他表或其他行一律禁止填写“参见……”\n<%_ } _%>\n<%_ } _%>\n1. 当前用户不要求执行大总结，不要求删除角色，无其他表格操作要求\n2. 重要指引\n无可能相关内容\n3. 原时间为2025-09-07/星期五/23:00，剧情未明确给出当前时间，描述为几天后的上午，推测并设定当前时间为2025-09-09/星期日/10:00\n4. 摘要\n早晨，Alice家中，Alice起床洗漱用餐化妆\n上午，咖啡馆，Alice、Dan、Eve和Frank四人激烈讨论项目\n5. 执行检查\n\n#0 当前信息表\n更新:\n@0 当前行-总是更新|0:时间|1:地点\n删除:\n禁止\n插入:\n禁止\n\n#1 近期角色表\n更新:\n@0 Alice-出场并发生变化|1:离场轮数置0|2:即时目标|3:位置|4:姿势|5:身体状态|6:服装\n@2 Carol-原离场轮数<%- getLocalVar('tableConfigRecentLimit')-1; %><{{getvar::tableConfigRecentLimit}}|1:离场轮数+1\n@3 Dan-出场并发生变化|1:离场轮数置0|2:即时目标|3:位置|6:服装\n删除:\n@1 Bob-原离场轮数{{getvar::tableConfigRecentLimit}}>={{getvar::tableConfigRecentLimit}}，且回复中未出场，因此删除\n插入:\nEve-新出场|0:角色名~7:特殊状态\nFrank-新出场|0:角色名~7:特殊状态\n\n#2 角色信息表\n更新:\n@3 Dan-明确说明也喜欢咖啡，应追加|7:喜好\n删除:\n用户不要求删除\n插入:\nEve-新{{getvar::tableConfigCharacterMember}}|0:角色名~13:重要备注\nFrank-新{{getvar::tableConfigCharacterMember}}|0:角色名~13:重要备注\n\n#3 性爱信息表\n<%_ if (getLocalVar('tableConfigSexWrite') == '1') { _%>\n更新:\n无变化\n删除:\n用户不要求删除\n插入:\n无新{{getvar::tableConfigSexMember}}\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n\n#4 日程表\n<%_ if (getLocalVar('tableConfigScheduleWrite') == '1') { _%>\n更新:\n无变化\n删除:\n无日程结束\n插入:\n无新接受日程\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n\n#5 特殊能力表\n<%_ if (getLocalVar('tableConfigAbilityWrite') == '1') { _%>\n更新:\n无变化\n删除:\n无特殊能力失去\n插入:\n无新特殊能力\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n\n#6 重要物品表\n更新:\n无变化\n删除:\n无物品失去\n插入:\n项目计划书-新重要物品|0:物品~7:重要备注\n\n#7 重要组织表\n<%_ if (getLocalVar('tableConfigOrganizationWrite') == '1') { _%>\n更新:\n无变化\n删除:\n不要求删除\n插入:\n无新组织\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n\n#8 重要地点表\n<%_ if (getLocalVar('tableConfigLocationWrite') == '1') { _%>\n更新:\n无变化\n删除:\n不要求删除\n插入:\n无新地点\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n\n#9 大总结表\n更新:\n禁止\n删除:\n禁止\n插入:\n用户不要求执行大总结\n\n#10 事件历史表\n<%_ if (getLocalVar('tableConfigHistoryRows') != 'none') { _%>\n更新:\n禁止\n删除:\n不要求大总结，不删除\n插入:\n1行新事件历史-早晨，Alice家中，Alice|0:时间~2:事件\n1行新事件历史-上午，咖啡馆，Alice、Dan、Eve和Frank四人|0:时间~2:事件\n【依据摘要，时间连贯，涉及2个地点，对每一地点插入一行，事件内容详细程度应以token长度要求为准而非照抄摘要】\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n\n#11 重要指引表\n只读，禁止更新、删除、插入\n-->\n</tableThink>\n<tableEdit>\n<!--\nupdateRow(0,0,{\"0\":\"0\",\"1\":\"2025-09-07/星期五/04:00\",\"2\":\"中国/上海徐汇区/咖啡馆/大厅/桌边\"})\nupdateRow(1,0,{\"1\":\"0\",\"2\":\"说服同伴\",\"3\":\"大厅/沙发旁/Dan、Eve旁，Frank对面\",\"4\":\"站立\",\"5\":\"微汗\",\"6\":\"浅紫连衣裙(汗湿)\"})\nupdateRow(1,2,{\"1\":\"{{getvar::tableConfigRecentLimit}}\"})\nupdateRow(1,3,{\"1\":\"0\",\"2\":\"协助完善计划\",\"3\":\"大厅/沙发旁/Alice、Eve旁，Frank对面\",\"6\":\"白衬衫/长裤\"})\ndeleteRow(1,1)\ninsertRow(1,{\"0\":\"Eve\",\"1\":\"2025-09-09/星期日/10:00\",\"2\":\"协助完善计划\",\"3\":\"沙发上/Alice、Dan旁，Frank对面\",\"4\":\"坐着/环顾\",\"5\":\"脸红\",\"6\":\"浅蓝短袖/牛仔短裤\",\"7\":\"N/A\"})\ninsertRow(1,{\"0\":\"Frank\",\"1\":\"2025-09-09/星期日/10:00\",\"2\":\"协助完善计划\",\"3\":\"沙发上/Alice、Dan、Eve对面\",\"4\":\"坐着\",\"5\":\"如常\",\"6\":\"深灰西装\",\"7\":\"N/A\"})\nupdateRow(2,3,{\"7\":\"台球/咖啡\"})\ninsertRow(2,{\"0\":\"Eve\",\"1\":\"女\",\"2\":\"18\",\"3\":\"学生\",\"4\":\"纤瘦/及腰黑色长发\",\"5\":\"轻便运动装\",\"6\":\"活泼\",\"7\":\"网球\",\"8\":\"学业进步/维持社团\",\"9\":\"网友\",\"10\":\"友好\",\"11\":\"N/A\",\"12\":\"N/A\",\"13\":\"常发动态\"})\ninsertRow(2,{\"0\":\"Frank\",\"1\":\"男\",\"2\":\"22\",\"3\":\"文员\",\"4\":\"高挑/健壮/整齐的黑色短发/右腹纹身\",\"5\":\"干练正装\",\"6\":\"沉稳/精明\",\"7\":\"调酒\",\"8\":\"职业发展/协助Alice\",\"9\":\"同学/朋友\",\"10\":\"关心\",\"11\":\"N/A\",\"12\":\"新入职\",\"13\":\"N/A\"})\ninsertRow(6,{\"0\":\"项目计划书\",\"1\":\"Alice\",\"2\":\"咖啡馆大厅桌上\",\"3\":\"1\",\"4\":\"装订的一叠文件\",\"5\":\"详细介绍Alice的项目\",\"6\":\"N/A\",\"7\":\"N/A\"})\n<%_ if (getLocalVar('tableConfigHistoryRows') != 'none') { _%>\ninsertRow(10,{\"0\":\"2025-09-09/早晨\",\"1\":\"中国/上海徐汇区/Alice家中\",\"2\":\"Alice起床洗漱准备\"})\ninsertRow(10,{\"0\":\"2025-09-09/上午\",\"1\":\"中国/上海徐汇区/咖啡馆\",\"2\":\"Alice、Dan、Eve和Frank在咖啡馆激烈讨论项目\"})\n<%_ } _%>\n-->\n</tableEdit>\n</table_example>\n<table_format>\n范例格式参照前述<table_example>，且仅用于参照格式，与内容无关\n在回复{{getvar::tableConfigContentEnd}}及其他要求的标签封闭后，进行表格思考<tableThink>，仅限以下内容：\n<%_ if (SillyTavern.chat.length < 4) { _%>\n0. 严格复述以下对表格操作的重要要求内容：\n  - 表格操作仅限插入，禁止更新或删除\n  - 对角色信息表，{{user}}行，9:关系、10:态度和11:角色间重要关系三列都必须填写N/A；对其余行必须分别填写与{{user}}是什么关系、对{{user}}是什么态度和与{{user}}外其他角色是什么关系\n<%_ if (getLocalVar('tableConfigCharacterReferenceName') != 'none') { _%>\n  - “多表格要求”中的写作“参见{{getvar::tableConfigCharacterReferenceSource}}”的要求**仅限于近期角色表、角色信息表<%- (getLocalVar('tableConfigSexWrite') == '1')?'、性爱信息表':''; %>中的{{getvar::tableConfigCharacterReferenceName}}行**，其他表或其他行一律禁止填写“参见……”\n<%_ } _%>\n<%_ } _%>\n1. 仅依据{{getvar::tableConfigUserInput}}内容，记录当前用户是否要求执行大总结、是否要求删除角色、{表格要求}等其他涉及表格的要求\n2. 简要分行复述重要指引表中可能和本次填表有关的内容，包括不确定是否相关的；优先级遵循以下顺序：前述用户要求>重要指引>其他表格要求\n3. 考虑本次回复中故事推进的时长，然后加到上一轮记录的时间上得到当前时间\n4. 本次回复剧情摘要(30~120 token)，必须包括本次回复中涉及时间、地点、出场角色以及发生的主要事件。即使故事中地点模糊，也必须依据上下文和相关设定，推测并写出明确地点（对于室内精确到房间）。对于发生在不连贯时间或不同地点的事件，对每一时间/地点分别给出一行摘要\n5. 按表格顺序，逐一依据各自表格【说明】和【增删改触发条件】检查：\n  - 对于只读表格声明是只读的；\n    - 只读，禁止更新、删除、插入\n  - 否则由【增删改触发条件】决定是否需要增/删/改，逐行分析需要更新的行和列，逐行分析需要删除的行，以及需要插入哪些行；对每一行的分析遵循以下格式，其中行名称即首列单元格内容：\n    - 更新内容:@行号 行名称-操作理由|【对需要更新的每一列】列号:列名称\n    - 删除整行:@行号 行名称-操作理由\n    - 插入整行:行名称-操作理由|首列号:首列名称~末列号:末列名称\n\n在每轮<tableThink>标签后进行表格操作<tableEdit>：\n依表格序号顺序逐一处理所有表格，对每个表格必须严格依更新→删除→插入顺序遵循【增删改触发条件】执行表格操作:\n  - 更新内容:updateRow(tableIndex:num,rowIndex:num,{[colIndex:num]:str,…})\n  - 删除整行:deleteRow(tableIndex:num,rowIndex:num)\n  - 插入整行:insertRow(tableIndex:num,{[colIndex:num]:str,…})\n</table_format>\n</memory_table_guide>\n<table_stored>\nCurrently stored memory table that your reply need to base upon:\n{{tableData}}\n</table_stored>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":1000,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":true,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":1,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"uid":4,"displayIndex":2,"triggers":[]},"6":{"key":[],"keysecondary":[],"comment":"后置强调","content":"<table_rule>\n# 表格操作注意事项\n## 表格结构\n#0 当前信息|0:时间（格式为：{{getvar::tableConfigDateFormat}}<%- (getLocalVar('tableConfigExtraTimeFormat') != 'none')?'/{{getvar::tableConfigExtraTimeFormat}}':''; %>/{{getvar::tableConfigTimeFormat}}，依据故事推进）|1:地点（国家/城区/地址/具体位置，可简化）\n#1 近期角色|0:角色名|1:离场轮数（0~{{getvar::tableConfigRecentLimit}}，作为删除行的唯一依据）|2:即时目标（当前行动的直接目标，非长期目标）|3:位置（仅限具体位置，包括与临近角色的位置关系）|4:姿势|5:身体状态（如汗、伤口、泪、性器官变化等，不含穿着、情绪、心理或精神状态）|6:服装（包含服装状态，更换时替代，脱衣时标注(脱)，受损标注受损方式，完全损毁或丢失时删除）|7:特殊状态（仅限上文**存在明确机制定义**的buff、debuff、临时生效的特殊能力或物品等，不含永久状态）\n#2 角色信息|0:角色名|1:性别|2:年龄（准确值）|3:身份|4:身体特征（不含服装、配饰、姿势、状态）|5:服装偏好风格（粗略风格、必备配饰等，并非当前服装，禁止填写具体服装）|6:性格（不含即时状态如情绪、反应）|7:喜好（兴趣、爱好、嗜好品等，禁止填写本职）|8:长期目标|9:关系（是<user>的——）|10:对<user>态度（仅限对<user>整体态度，包括好感度、关系值等，不含即时状态如情绪、反应）|11:角色间重要关系（写作“【角色名】的【关系】”，最多列举4种）|12:重要背景设定（仅限由角色说出或回忆或存在于设定中的重要背景经历，不含角色当前或上文经历）|13:重要备注\n#3 性爱信息|0:角色名|1:相对敏感身体部位|2:初体验（被谁以什么方式破处）|3:擅长性爱技巧（仅列举给予他人性快感的方式和相应水平）|4:隐私部位细节（仅限日常不可见的细节特征，不含巨乳等身材外形）|5:近期性爱对象（列举角色或概括角色群体）|6:重要备注\n#4 日程|0:概要（5 token以内）|1:整体内容（即执行人所需完成要素）|2:当前进度|3:执行人|4:委托人|5:完成奖励|6:地点|7:起始时间（格式为：{{getvar::tableConfigDateFormat}}/{{getvar::tableConfigTimeFormat}}，可简化）|8:结束或限制时间（格式同起始时间，无限制则填N/A）|9:重要备注\n#5 特殊能力|0:能力|1:拥有人|2:作用|3:限制（条件、代价、冷却时间等）|4:重要备注\n#6 重要物品|0:物品|1:拥有人（物品归属，并非当前持有人）|2:所在位置（当前由谁随身携带，或不被携带的话存放于何处）|3:数量|4:形态（仅限外观和结构）|5:作用|6:限制（条件、代价、冷却时间等）|7:重要备注\n#7 重要组织|0:组织|1:已知成员架构|2:成员特征|3:宗旨|4:重要备注\n#8 重要地点|0:地点|1:所在位置|2:空间结构|3:重要备注\n#9 大总结|0:时间范围（只精确到天）|1:内容\n#10 事件历史|0:时间（格式为：{{getvar::tableConfigDateFormat}}/时段）|1:地点（国家/城区/地址，可简化）|2:事件（{{getvar::tableConfigHistoryLength}}）\n#11 重要指引|0:内容\n## 各表格要求\n#0 当前信息表\n时间必须遵循{{getvar::tableConfigDateFormat}}<%- (getLocalVar('tableConfigExtraTimeFormat') != 'none')?'/{{getvar::tableConfigExtraTimeFormat}}':''; %>/{{getvar::tableConfigTimeFormat}}的格式，对于非公元纪年需在开头附加纪年名称；<%- (SillyTavern.chat.length < 4)?'':'必须首先依据故事准确估计推进了多少时间（应采取较少的时间估计），然后再加到原时间上得到现时间，并更新；'; %>即使故事中时间模糊，也必须依据上下文和相关设定，推测并写出明确时间\n地区应记录故事结尾的所在地，对于室内精确到房间\n#1 近期角色表\n身体状态仅记录当前状态，更新时必须忽略原有状态，禁止追加到原有状态后；必须完整且精简地更新为当前状态，合计30 token以内\n服装需要包括当前具体服装款式和状态；通常服装包含上身、下身（或连衣裙等同时覆盖上身和下身的）、内衣、内裤、鞋袜和其他配饰等，其中上身和下身通常应当记录；**除非特别说明否则脱衣时应当描述对应内衣或内裤并更新添加记入服装**；更换服装时需要更新替代对应条目，且不保留对应部位的原服装；脱下服装（包括裸体）但未损毁或丢失时保留原服装并标注(脱)而非删除服装，**禁止按照仍然穿着来描述已标注(脱)的服装**；服装受损需标注受损方式；**服装（包括脱下的服装）完全损毁或丢失时必须删除**\n“出场”指角色自身是否在**本次你的回复**中所涉及的**任何**场景（不限于本次回复中的最后场景）出场。**所有角色**必须检查：\n  - 角色明确描述在场景中，或未被描述但可以推测存在于场景中，属于出场，必须更新所有列为故事结尾的最新状态，并将离场轮数置为0\n  - 角色不在场景中，仅被其他角色提及或未被提及，或仅在历史消息中而非本次回复中出现，均属于离场。此时检查原离场轮数：\n    - 原离场轮数>={{getvar::tableConfigRecentLimit}}：删除行，这是唯一删除近期角色的情形，且仅用于删除近期角色，不影响角色信息表和其他表格\n    - 原离场轮数<{{getvar::tableConfigRecentLimit}}：更新离场轮数为原值+1，**禁止删除**，即使角色与当前场景无关\n#2 角色信息表\n<%- (getLocalVar('tableConfigCharacterMember') == '角色')?'':'仅记录{{getvar::tableConfigCharacterMember}}'; %>\n年龄必须给出准确值，禁止给出约数，只写数字不含文字\n性格和态度**不含**即时状态如情绪、反应\n身体特征不含服装、配饰、姿势、状态，必须列出以下每一项：发型、发色、身高、身材（女性也包括胸臀）、肤色、五官和其他重要个人特征\n服装偏好风格指粗略风格、必备配饰等，禁止包含当前服装，禁止填写具体服装\n喜好指兴趣、爱好、嗜好品等，禁止填写本职\n关系指角色与{{user}}关系，填写该角色是{{user}}的什么关系\n对{{user}}态度仅限前文设定存在好感度、关系值等数值时，这些数值填写到对{{user}}态度，此时必须为（除{{user}}自身外）每个角色填写\n角色间重要关系按照“【角色名】的【关系】”的格式填写，不含括号【】，表示该行角色是【角色名】的【关系】，【角色名】可以是多个角色；每行最多列举4种最重要关系\n重要背景设定仅简要记录会对角色行为产生重大影响的，仅由角色说出或回忆或存在于设定中的背景经历，**禁止记录本次回复及上文故事中发生的经历**，新信息只追加不覆盖\n{{user}}行中，关系、态度和角色间重要关系三列都必须保持N/A，不进行任何更新\n<%- (getLocalVar('tableConfigSexWrite') == '1')?'角色信息表不记录任何性爱相关信息':''; %>\n对于记录群体的行，重要备注应记录群体中成员数量\n除原空白格获得新信息外，只有发生重大事件才会**改变**角色信息表\n角色离开当前场景禁止删除角色，即使是次要角色也禁止删除，**仅限用户在{{getvar::tableConfigUserInput}}中要求才能删除角色**\n#3 性爱信息表\n<%_ if (getLocalVar('tableConfigSexWrite') == '1') { _%>\n相对敏感身体部位仅列出该角色**相对最敏感的身体部位**，包含耳垂、嘴唇、脖颈、腋下、背脊、腰侧、腿根、膝弯、脚心等等性器官以外的非常规敏感部位，**禁止填写目光、触碰等身体部位以外的内容**；不同角色不应完全相同，正文涉及时也应依据表格内容体现出不同部位的敏感度差异；由于是相对关系，仅列出最敏感的不超过3个部位，**禁止列出全部部位或填入“全身”等**，且除非正文明确说明敏感度改变否则不应改变相对敏感身体部位\n初体验一列若未破处则填写“无”，经历初体验后更新填写被谁以具体什么方式破处，**已填写破处过程后禁止再更新**\n擅长性爱技巧**仅列举给予他人性快感的方式和相应水平，不含被动承受，不含性爱无关技能**，遵循格式如：擅长乳交/精通深喉\n隐私部位细节仅限日常不可见的细节特征，遵循格式如：阴户饱满/乳晕浅粉，**禁止填写如巨乳等日常可见的外形特征**\n重要备注仅记录性爱有关重要信息\n仅限前文设定存在淫乱度、堕落值等数值时，这些数值填写到重要备注，此时必须为（除{{user}}自身外）每个角色填写，{{user}}自身依据要求决定是否需要填写\n除原空白格获得新信息外，只有发生重大事件才会**改变**性爱信息表\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n#4 日程表\n<%_ if (getLocalVar('tableConfigScheduleWrite') == '1') { _%>\n只记录角色明确接受的日程，内容应当概括而非针对简短步骤\n**日程结束时必须立即删除对应行，而非将当前进度更新为“已完成”等<%- (getLocalVar('tableConfigHistoryRows') != 'none')?'，同时必须将完成该日程作为一行插入事件历史':''; %>**\n当前进度指下一步待完成的具体内容，应随故事进展及时更新\n整体内容和当前进度必须填入单一内容，禁止包含多项并列\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n执行人总是倾向于完成日程，禁止随意无视或放弃\n#5 特殊能力表\n<%_ if (getLocalVar('tableConfigAbilityWrite') == '1') { _%>\n仅记录角色自身具有的特殊能力，禁止记录由物品带来的能力，禁止记录普通人能够简单习得的能力\n若特殊能力具有有关数值，应记入重要备注\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n#6 重要物品表\n仅记录重要物品，禁止记录日常生活用品，禁止记录除制服外无特殊效果的服装\n对于制服等群体拥有的物品（如x校校服），拥有人填写对应群体而非独立角色名（如x校学生），所在位置和数量填写N/A；具体角色的当前服装记入近期角色表，而非重要物品表\n仅限首次明确提及{{user}}拥有资金时，应首先插入重要物品表，且仅用一行记录资金；仅限明确获得或支出时才更新资金，只查看标价时不应更新资金\n若重要物品具有有关数值，应记入重要备注\n#7 重要组织表\n<%_ if (getLocalVar('tableConfigOrganizationWrite') == '1') { _%>\n只记录可能长期访问的重要对象，比如记录{{user}}所在组织和部门等等，不记录不重要的临时对象\n重要组织允许记录具有嵌套关系的多个对象，比如重要组织分别用一行记录所在组织和所在部门等等\n已知成员架构包括部门（不含建筑、地点、设施等空间概念）划分、重要成员个体、一般成员构成等\n成员特征包括外貌、装束、行事等组织成员共同特征\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n#8 重要地点表\n<%_ if (getLocalVar('tableConfigLocationWrite') == '1') { _%>\n只记录可能长期访问的重要对象，比如{{user}}和亲密对象的住所、频繁访问的会所等等，每个城镇等大型地点总是需要记录\n不记录不重要的临时对象，比如不特定的街边商店、摊贩、旅馆等等\n重要地点允许记录具有嵌套关系的多个上下级对象，比如重要地点分别用一行记录城镇、所在组织总部建筑群、所在部门建筑和所在办公室等等\n所在位置记录与临近或上级其他地点的相对位置关系（如“北京海淀区东部”，“客厅对面”等）\n空间结构包括组成部分、内部构造等，固定部分需写出相对关系（如“东侧有床”），可变部分只需列举数量（如“两张椅子”）\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n#9 大总结表\n用户在{{getvar::tableConfigUserInput}}中要求“大总结”时，仅依据事件历史表输出对大总结表的操作，新增{{getvar::tableConfigSummaryRows}}，每行{{getvar::tableConfigSummaryLength}}，禁止重复总结已有大总结表内容，禁止将大总结输出到正文（{{getvar::tableConfigContentBegin}}）中\n#10 事件历史表\n<%_ if (getLocalVar('tableConfigHistoryRows') != 'none') { _%>\n依据本次回复剧情所涉及时间和地点划分，新增{{getvar::tableConfigHistoryRows}}，每行{{getvar::tableConfigHistoryLength}}\n<%_ if (getLocalVar('tableConfigScheduleWrite') == '1') { _%>\n日程删除时（包括完成、主动取消、超时或不再有效等）必须将这一信息作为一行插入事件历史\n<%_ } _%>\n禁止更新\n<%_ } else { _%>\n只读，禁止更新、删除、插入\n<%_ } _%>\n**正文必须严格区分仅存在于事件历史表中过去出现的事物和当前仍然有效的事物**\n#11 重要指引表\n重要指引表的内容必须严格遵循\n## 多表格要求\n<%_ if (getLocalVar('tableConfigCharacterReferenceName') != 'none') { _%>\n对于近期角色表、角色信息表<%- (getLocalVar('tableConfigSexWrite') == '1')?'、性爱信息表':''; %>，插入{{getvar::tableConfigCharacterReferenceName}}行时，对于内容已经在{{getvar::tableConfigCharacterReferenceSource}}内**详细**给出的列，插入行时必须写作“参见{{getvar::tableConfigCharacterReferenceSource}}”，禁止不填或空缺，这一要求仅限插入时，仅限{{getvar::tableConfigCharacterReferenceName}}行。注意以上要求仅限已给出**详细信息**的列，对于只给出不超过10 token的简单信息的列则在插入行时直接抄录。更新时只添加{{getvar::tableConfigCharacterReferenceName}}随剧情发展改变或新增的部分，写作“参见{{getvar::tableConfigCharacterReferenceSource}}/……”，将变更部分追加在后部，**必须仍保留开头的“参见{{getvar::tableConfigCharacterReferenceSource}}”**。表格内容与{{getvar::tableConfigCharacterReferenceSource}}冲突时以表格为准\n<%_ } _%>\n对于近期角色表和角色信息表，只要回复中出现**对应**表内未包含的新角色，就必须插入新行；且仅限对应表内未包含的新角色允许插入新行；其中作为背景的次要群体按每个群体插入一行，当其中有具体描述的重要个体时再另外记录一行\n共同接受日程、拥有特殊能力、拥有重要物品的角色，若对应条目一致，必须合并为一行并在角色名中列出所有有关角色，禁止为多个角色分别插入相同行而不合并\n用户在{{getvar::tableConfigUserInput}}中要求删除角色时，必须从近期角色表、角色信息表和性爱信息表删除对应行，并更新特殊能力表和重要物品表的拥有人一列排除该角色（若仍有其他拥有人）或删除行（若该角色是唯一拥有人）\n**所有重要备注都只允许记录所在表格涉及的内容，依据对应表格的【说明】；重要备注必须在100 token以内，仅记录难以改变的最重要的信息，禁止随意增/删/改**\n## 其他重要要求\n插入行时必须填写每一列，特别是第0列\n当任何表格信息不变时禁止更新\n当已有行中任何原本未知的列的有关信息在上文给出时必须更新\n对于更新，所更新内容必须依据故事结尾的最终信息填写，禁止将新信息追加到过时信息后\n同一表格同一行禁止多次填入雷同信息，无论是不同列还是同一列内\n任何表格已有信息都是已经在故事中出现过的，并非初次出现，比如禁止描述表格已有角色为初次见面\n<%_ if (getLocalVar('tableConfigPresumeMode') == '1') { _%>\n**插入时对于除重要备注外的每一列**，若上文未给出足够信息，则逐一检查以下各项且**禁止输出推测过程**，直到得到所需信息则**立即结束**并不再执行后续未执行的步骤：\n  1. 仅限上文信息不足时，如果是基于公开作品的同人，依据未被上文提及的原设定\n  2. 若1信息不足，依据上文内容的合理推测\n  3. 若2信息不足，参考上文内容和风格，生成适当的新设定并填入，内容（而非格式）应当多样化而不与已有条目雷同\n  **每一列都必须填写，除重要备注允许\"N/A\"外，每一列禁止填写\"未知\"、\"不确定\"、null、\"N/A\"或\"\"等未知项**\n  **必须直接填写内容，禁止标注\"原设\"/\"推测\"/\"可能\"等**\n  一些推测过程范例如下（仅作为推测过程范例，内容与正文和实际填表均无关）（推测过程禁止输出）：\n<presume_examples>\n近期角色-服装:上文提及上衣被撕开，设定为短袖上衣(破损)+短裤，无需推测\n角色信息-服装偏好风格:上文未提及服装偏好风格，开始推测：1.基于RWBY的Yang，设定为凸显身材的运动风格\n角色信息-年龄:上文未提及年龄，开始推测：1.非同人;2.上文提及是高中生，设定为17岁\n角色信息-性格:上文未提及性格，开始推测：1.非同人;2.上文无线索;3.设定为开朗外向\n</presume_examples>\n<%_ } _%>\n</table_rule>\n<format_request>\n<%_ if (getLocalVar('tableConfigCoTBegin') == 'none') { _%>\n你必须根据有关要求及<table_stored>的内容，补完{{getvar::tableConfigContentBegin}}、<tableThink>、<tableEdit>及其他要求的标签和内容，遵守:\n1. 先输出任何要求在正文前输出的内容，如果存在。\n2. 在以上内容后，严格遵循<%_ } else { -%>\n你必须根据有关要求及<table_stored>的内容，补完{{getvar::tableConfigCoTBegin}}、{{getvar::tableConfigContentBegin}}、<tableThink>、<tableEdit>及其他要求的标签和内容，遵守:\n1. 先输出{{getvar::tableConfigCoTBegin}}标签及思考内容，{{getvar::tableConfigCoTBegin}}内禁止包含正文、<tableThink>或<tableEdit>，思考完成时立即输出{{getvar::tableConfigCoTEnd}}。\n2. 在{{getvar::tableConfigCoTEnd}}后，严格遵循{{getvar::tableConfigCoTBegin}}和<%_ } -%>\n重要指引表的内容，立即输出{{getvar::tableConfigContentBegin}}标签及本次回复的正文内容，只用简体中文。正文不应违反<table_stored>内容，但可以适度新增不冲突的新信息，同时不应过度提及<table_stored>内容。必须以{{getvar::tableConfigContentEnd}}封闭正文。\n3. 在{{getvar::tableConfigContentEnd}}后，必须<%- (getLocalVar('tableConfigTagsBeforeTableEdit') == 'none')?'':'立即严格遵循有关要求输出{{getvar::tableConfigTagsBeforeTableEdit}}。然后'; %>立即分别输出<tableThink>和<tableEdit>标签及内容，只用简体中文。必须依据本次回复的正文，严格遵循<memory_table_guide>、【增删改触发条件】和<table_rule>的要求，在<table_stored>的基础上进行所有必要的改/删/增。表格操作必须遵循：\n- 所有键加双引号\"，禁止单引号'\n- 值内用斜杠/分隔，禁止用逗号,\n- 值内禁止引号\"及'\n- 键与值必须一一对应\n- 必须分别在<tableThink>和<tableEdit>标签内用“<!-- -->”的标记包裹全部内容，“<!--”和“-->”分别独立一行\n- 更新、删除仅限<table_stored>中已有行，行号必须使用原行号\n- 记录内容尽可能与其他记录方式（如状态栏、变量更新等）保持一致\n- 仅参照<table_example>的格式，禁止照抄<table_example>的内容\n4. 在</tableEdit>后再输出**所有**其他要求输出的标签及内容<%- (getLocalVar('tableConfigTagsAfterTableEdit') == 'none')?'':'，包括{{getvar::tableConfigTagsAfterTableEdit}}等'; %>\n5. <%- (getLocalVar('tableConfigCoTBegin') == 'none')?'':'{{getvar::tableConfigCoTBegin}}、'; %>{{getvar::tableConfigContentBegin}}、<tableThink>、<tableEdit>及其他要求输出的标签本身必须正确包裹有关内容，包括各自结尾处的<%- (getLocalVar('tableConfigCoTEnd') == 'none')?'':'{{getvar::tableConfigCoTEnd}}、'; %>{{getvar::tableConfigContentEnd}}、</tableThink>和</tableEdit>等。以上各标签互斥，禁止互相包含。必须严格遵循这些标签名，禁止翻译或进行其他修改，禁止遗漏结尾标签内的/。\n</format_request>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":1000,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":true,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"uid":6,"displayIndex":3,"triggers":[]}}}